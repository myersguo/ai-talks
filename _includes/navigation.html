{% assign pages_by_dir = site.documents | where_exp: "item", "item.path contains '/'" | where_exp: "item", "item.extname == '.md'" | group_by_exp: "item", "item.path | split: '/' | first" %}

{% for dir in pages_by_dir %}
  <h2>{{ dir.name | replace: '_', ' ' | capitalize }}</h2>
  <ul>
    {% for item in dir.items %}
      <li><a href="{{ item.url | relative_url }}">{{ item.data.title | default: item.name | remove: ".md" }}</a></li>
    {% endfor %}
  </ul>
{% endfor %}
